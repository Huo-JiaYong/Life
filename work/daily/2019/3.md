### 3 - 1

1. 修改邮件发送的连接建立方式，避免重复建立连接导致的 550 错误
2. qq 邮件会有发送频率的限制
3. 使用阿里企业邮箱未出现连接频率限制和连接失效的情况..
4. 清理使用 lombok 的代码，统一不使用

### /

### 3 - 4

1. 修改扫描结果入库出现的频繁访问数据库的问题

   删除提前入库代码，为什么会有提前入库呢..

   因为 80% 就设置为任务完成就修改了数据的任务状态

2. 

### 3 - 5

1. 删除任务完成 80% 提前结算的机制

   提前结算后，之后的 20% 的入库都需要访问数据的数据

   导致频繁访问数据库（就算频繁访问也不应该找不到数据）

2. 排查文件扫描顺序错误的问题

   可能系多节点的同一引擎的扫描效率不一致

   后来的文件被分配到了扫描快的节点上，所以后来的先完成了

3. 修复重发任务的优先级差别过大的问题

   score = score - number 导致 -1 -2 -3 -4 递增

### 3 - 6

1. 上传引擎文件过大失败的问题

   设置了 http.multipart.max-file-size=20M 就限制了所有上传文件的大小

   如何将这个接口区分开不限制大小呢..

2. 修改查询任务信息的方式

3. 检测结果为要发送邮件之后，未发送邮件

   只检测了这类威胁是否发送，没有检测是否过期..

4. 修复并发下的邮件重发问题

   判定是否发送修改为同步方法

### 3 - 7

1. ROBIN 所有任务的日志相关信息直接都打印 sha256

2. 邮件告警为什么发送了10次.. 收到了11个邮件呢

   因为开了两个程序订阅告警通道..另外一个程序设置了间隔 所以只发了一次..

### 3 - 8

1. 积极一点啊，做的什么功能都要关心什么时候**发包**（就是正式发布）

   发包就是相当于正式发布，小心翼翼的去做好。 但是不知道会很困惑

   **求求你，别他妈光反省。改啊！改啊！改啊！**

2. 任务完成但未结算的情况

   1. 引擎卡住导致获取的结果组装错误
   2. 结果信息错误导致查询任务信息错误
   3. 获取任务信息错误导致结算任务错误
   4. 所以未结算

### /

### 3 - 11

1. 全网文件列表的表关系整理和上传记录筛选

### 3 - 12

1. ROBIN 所有文件计数方式为：以文件个数为准
2. 全网文件列表所有路径标签查询

### 3 - 13

1. 访问 10 出错.. 一开始能 ping 通但访问不了端口就应该想到 ip 占用的问题
2. 文件扫描计数错误
   1. 调用方法的次数是正确的，证明程序在多线程处理上没有问题
   2. 如果是调用数据库导致的计数不对，为什么节点和总数相差的数据都是一样的？
   3. **结果：**因为错误判定导致调用了多余次数的新增

### 3 - 14

1. 修改文件扫描状态的判定方式和机制

   发现问题就要从根本上解决问题，而不是掩耳盗铃的去掩饰掉

   不能从根本上修改问题则不可能正常处理

2. 测试接口的正确性和微调

### 3 - 15

1. 清理掉线引擎的任务判定：此引擎未返回结果的情况下
2. 全网文件列表做好了 为什么问的时候不说呢..

### /

### 3 - 18

1. 做什么都要想好（很多时候都是为了快点完成），即使为了快速完成也要有自己的想法。不要老是想着先做好 然后在检查，**检查更浪费时间**

2. DS的存活，ES的状况，每个服务器的状态（运维中心状态管理）

3. 新增邮件告警通知关闭接口

4. lsof -i:80  netstat -tln|grep 8080

5. find [path] [option] [args]

   find / -name robin.log

### 3 - 19

1. 重新发布任务的话，如果任务一直都未被清理会一直堆积相同任务

2. 设置最大任务时间，这个时间内都未被完成的话 就直接结算任务

3. ROBIN 节点重复排查（的确是节点先开启导致的），新增同步方法

4. DS service 进程 的 CPU， diskIO， RAM
   DS自己写入到ES中，1-5分钟一次（定时任务）。**3个月之前的数据删除**（肯定是以天为单位，所以每天删除一次）

   DS把自己机器的ip，端口，type为索引

   字段：ip port type, cpu io mem net

5. 运维中心读取这些DS的相关信息

### 3 - 20

1. es maven 的仓库优先级

   因为设置 aliyun mirrorOf：* 所以导致在 pom.xml 中设置的仓库信息未生效

   **mirrorOf：* 代表所有都走此仓库** 

   应该设置为：central 代表中央仓库的镜像

2. 排查 ROBIN 引擎下载失败的问题

### 3 - 21

1. 获取系统 IP 和 port 信息，ES 检测 index 是否存在
2. 编写 ROBIN 测试环境文档

### 3 - 22

1. 请假..

### /

### 3 - 25

1. DS运行状态监控的定时删除

2. 测试监控是否正确

   编译错误：找不到类 没有真的去类文件里面找相关类是否存在..

3. 获取不到 port

   使用的 spring-boot 未使用tomcat 所以无法获取端口.

   其实是因为 server.port 只在 websocket 中使用（但是我屏蔽了websocket），未使用 spring-mvc 

### 3 - 26

1. 取消 websocket 注释，可以获取到 port，提交代码

   整个设计可能还有问题.. 怎么获取到所有节点的基础信息呢

2. git 不提交 EDRNetDataObject.java 文件

   ```shell
   # 执行命令将db.php加入不提交队列
   git update-index --assume-unchanged include/db.php
   
   # 执行命令将db.php取消加入不提交队列
   git update-index --no-assume-unchanged include/db.php
   ```

3. ROBIN 测试准备、演示和必需提供文档整理

4. 修复文件二次扫描出现的扫描计数错误问题

5. 修复文件二次扫描出现的引擎扫描数量错误问题

### 3 - 27

1. 升级 IDEA 版本

2. 修改DS状态保存的数据结构

3. IDEA 的布局完全不显示..

   关闭所有IDEA重启后正常..

4. ES的date存储

### 3 - 28

1. 聚合查询获取所有的ES服务器名称

2. 根据时间和server查询ES服务器的状态列表

3. 连接ES失败：升级elastic版本为 6.5.4

   hit.getSource() => hit.getSourceAsMap()

4. DS服务器状态监控

   大小必须设置（默认10） time/5，排序修改

5. 新增菜单类型：外部直链  直接在新窗口打开页面

### 3 - 29

1. redis 的状态在页面展示
   1. 不能获取 jedisPool，需要自己配置。和现在的集群方式不符合
   2. 查找到 RedisClusterConnection.info()，无法直接注入
   3. 使用 RedisTemplate.getConnectionFactory().getClusterConnection() 获取
2. 新建 Redis 页面
3. 修复邮件发送失败的问题