## 3 yue 

#### 3-4

1. 修改所有入职第一课都完成才认证（多个课程完成学员求并集）
2. 直接修改计件数据，不使用任务的（避免同步时间比任务执行时间晚则会丢失一天的数据）

#### 3-5

1. 优化所有课程完成的筛选（初始化后就不能赋值）
2. 和产品确认要不要实时查询课程进度：不要
3. 补充技术实现文档功能点
4. 提测流程：merge into test -> CICD -> portainer log
5. 排查新增学习分组太慢的问题：同步太多茶生的人员信息
6. 引发出需要修改：员工和 umu 绑定的**筛选**功能（刘科开发）
7. **错误提交：**未提交查询 2 个月的、判空忘了返回！（**提交之前一定要先运行测试一下**）
8. 打包引用错误：
   1. 认为没有打包（实际上：没有打包之前的都不能运行） 
   2. 没有引用，怀疑是 CI 的问题（实际上：被新打包的覆盖了）

#### 3 - 6 

1. 

#### 3 - 7

1. 项目有一些不是特别完善，要自己有判别能力
2. 筛选所有的相关接口，是否需要判定入职第一课的认证
3. 需要修改同步时没有计件方式就新增么 ？从程序的健壮性来说是可以的
4. 修改公司为计件后会同步用户为计件方式（陈开）

#### 3 - 8 

1. 测试多个新增计件数据的接口，有技能和没技能时的计件方式是否正确
2. 多个分支的 CD 会发生冲突么？ 如果配置的 **deploy 的环境相同**就会（现在就是只有一个 dev 环境）
3. 修改判定的逻辑，服务运行未运行就进入 false 的逻辑（应该优先 ture 的判定条件）

#### /

#### 3 - 11

1. 检查查询第一课认证状态的 true 的逻辑是否正确

2. 捣鼓一下 ssh 工具，还是要 MobaXterm 就行把

3. 提测：就是相当于交付，**要保证测试环境的版本正确**（和其他版本冲突，多沟通！要主动落地）

4. 排查测试第一次新增用户出现的计件模式错误问题：用户和计件数据不匹配就会初始化

   改：计件方式根据用户的认证状态来

5. 用户未获得技能认证就开始计件了（同上）

   因：同上

6. 新增 app 的计件数量错误：列表中排除了停用用户，计数没有

   改：在新增计件数据时，停用用户不新增（启用时会新增）

#### 3 - 12

1. 初始化门店的计件人员信息时，新增店长判定（想好逻辑，拣一块丢一块）
2. 从非计件门店到计件门店的员工是计件状态，是对的
3. 只有有计件信息时，调店等才会保留员工的计件信息
4. 同步接口到 APIFOX，学习下标准文档注释

#### 3 - 13

1. 发布计划文档
2. 全局参数、接口用例、标准注释（java里的注释就行了）
3. 看一下导出后的文档，结果把软件删啦

#### 3 - 14

1. 修改技能认证的匹配方式：入职第一课 + 所属职位（名字可能会变动，更好定位）
2. 测试上线

#### 3 - 15

1. 看一下其他开源项目怎么集成 RocketMQ 的
2. GMV 目标的需求整理，技术文档编写

#### /

#### 3 - 18

1. 补充文档的缺失接口信息 和 SQL
2. 自己整理了一套技术方案实现的文档格式（还是用组长给的好）
3. 周四就要提测 ！？
4. 重新沟通需求和确定提测的功能

#### 3 - 19

1. 修改展示目标杯量的接口
2. 小程序是否展示的数据修改
3. 小程序开发工具用不了？（**有报错先搜一下，然后再问，不要养成路径依赖**）
4. 测试修改的接口在 API 中是否正常

#### 3 - 20

1. 试一下测试版本正常
2. 杯量计件的门店同步不正确（有多个模板记录）
3. **初始化同步数据不正确（没有去除茶生关键字！这些魔法值如何统一？）**
4. 如何修复线上数据
   1. 查询所有已有技能认证 & 非计件的人员 => 改为计件模式
   2. 将他们更新成计件标记（从认证开始算？要记录其获得认证的时间和数据？）
   3. 客户问起来如何回复 ？
5. 修改 feign 的调用方式

#### 3 - 21

1. 修改门店计件类型，但是插入数据的问题（重写了 insertBatch 方法，**要仔细检查实现啊**）

2. 下午请假

3. **错误计件方式的处理：**

   1. 有认证 & 非计件的员工：需要改为计件（排除手动修改为非计件的）

      重算工资期间：直接从 03.14 开始

   2. 已经手动修改为是的员工：不改

      重算工资期间：认证时间 -> 修改时间

4. 发包后要多关注自己开发的功能，不要等着

#### 3 - 22

1. 导入 excel 的基本实现方式

#### /

#### 3 - 25

1. 新增的功能接口要写完
2. 有得功能尽量复制（但是找得成本也挺高得，而且人容易乱），直接大规模得复制 ？
3. 接口调通了

#### 3 - 26

1. 查询接口：筛选门店错了
2. 更新接口：没有更新人和时间
3. 导入接口：查询的门店错误、模板文件错误
4. **不要新建分支**
5. 修改其他接口的数据来源

#### 3 - 27

1. 重新导入的 SQL 有问题（通过 store_id 可能会出现 store_no 被遗漏的问题）
2. 修改一下大小的校验，EXCEL 的多行提示兼容（组件BUG 跳过2行读取数据为NULL）
3. 校验各个用到 store_target 的地方，确认不修改
4. 上传更新 GMV 的数据源，**没有引用 API 的方式 ！！！太傻了**
5. 查询门店通过 code 
6. 列表的门店权限新增
7. 查询门店的结果是 null **feign !!!**

#### 3 - 28

1. ~~导入过程中的权限控制 ？~~ 暂时不管
2. 页面 GMV 的数据展示 ？（历史数据错误的）
3. 修改时的服务器数据校验 ？
4. **门店名称多个？**（实际上 is_deleted 只会有一个）
5. ~~同步数据以 store_id 进行分组（store_no不一样导致数据丢失）~~OR 以 store_code 分组（去掉id=0的数据就没有重复了）
6. 查询没有数据，但是接收到 R.data != null 并且属性都是 null（先手动处理一下）
7. **没有同步新增 GMV 的接口！！！**
8. **BigDecimal 序列化后是 -1**
9. 不是为空的数据调用错误了，**而是返回的 data 中没有数据**，转换成 null 错拉~（仔细分析报错原因）
10. 所有的数据都返回 data ，消息放到 msg 就行了
11. 统一 store_code 进行查询 GMV，**实际上在改的时候就应该发现，自测是个问题**
12. **新增校验没有生效！！！因为居然没有写 retrun !**

#### 3 - 29

1. 用 apifox 进行接口的测试
2. 更新全局变量的 token
3. 自动检查更新全局变量 access_token（要所有都加上前置方法，并且还有过期时间）

#### /

#### 4 - 1

1. 还是不用 ACCESS_TOKEN 了，主要是 token 接口更新过期时间（算啦）
2. 新增门店基本工资的信息查询（**通过接口可以查到别人的信息？系统本来就酱紫的**）
3. 更新测试环境失败：从报错上看加载了阿里云的 nacos ，所以可以确定是配置问题

#### 4 -2 

1. 校验身份证又出错啦！**按照需求的业务范围修改**（**不是这个范围尽量别改！！！**）
2. 请求的方法忘了加 / 号 **规范性啊，提交的时候以 code review 的心态去逐行走读！！！**

#### 4 - 3 

1. 重新检查线上功能的正确性
2. 查看 4 月的需求文档

#### / 

#### 4 - 7 

1. 某用户未自动获得认证：用户绑定的 umu_id 是 0 导致。（**加强健壮性**，这个匹配不到尝试用其他参数）
2. **不止是错误的数据要日志**，**同步的数据**也尽量打日志。不然只能通过数据分析了
3. 整理学堂的相关需求

#### 4 - 8 

1. 各个功能的需求方案和实现逻辑盘点
2. 申请后分组，学习，自动晋升 -> 自动分组，学习，申请晋升
   - [ ] 删除晋升的同步任务
     - [ ] 那和晋升相关的技能认证都在他~~申请~~**晋升完成时**才能加上？
   - [ ] 去掉所有晋升分组（直接将晋升分组的技能配置到长期里） ~~保留晋升分组，自动进入分组~~
     - [ ] 自动进入分组，每天需要扫描所有人加到对应的晋升分组中 ？
       - [ ] 只需要初始化一下 ，以后都晋升时添加 
       - [ ] 如果新加的认证就要下一级的所有加？
       - [ ] 新加的人也要自动同步 涉及太多了
     - [ ] 怎么确定是否要加入分组 ？下一职级 + 分组中没有？
     - [ ] 加入到晋升分组后什么时候删除。晋升成功的时候才移除，再添加到下级分组中？

#### 4 - 9

1. 要不要先写技术实现文档（现有的文档看起来其实并不是很方便）
2. 讨论需求拆分的问题
3. 阅读之前的审批流程方式：一级一级的创建
4. LocalDateTime 序列化错误了，因为指定了全局的序列化问题

#### 4 - 10

1. 序列化时间错误的问题：反序列化用的时间戳
2. 新的审批流程的实现方案考虑
3. 下午评审测试用例

#### 4 - 11

1. 直接生成所有审批人的记录

#### 4 - 12

- [x] 公司配置 HR 的功能

#### /

#### 4 - 15

- [x] 新的审批流程
  - [x] 流程流转
  - [ ] 下级人员校验 ？
  - [x] 完成获得认证
- [x] 审批的页面接口改动

#### 4 - 16

1. 晋升时，需要将之前的缺失的技能补上（更新和）
2. 新增 OR 更新用户现有的技能

#### 4 - 17

1. 完成晋升申请的流程接口

#### 4 - 18

1. **排查 umu 在查询课程进度时，部分用户数据不完整的问题**

#### 4 - 19

1. 自测晋升全流程的接口

#### /

#### 4 - 22

1. 查看工资单的相关需求，初步计划涉及的表和字段同步
2. 查看设计图，配合规划设计表功能
3. 用户离职后，相关的晋升申请的处理

#### 4 - 23

1. 拉取分支，整理基础的相关代码
2. 完成工资单用户相关的功能接口开发

#### 4 - 24

1. 模拟数据，自测工资单相关接口的数据

#### 4 - 25

1. 和前端对接相关的接口
2. 新增全部门店的职位展示，计件数据展示不完整的问题

#### 4 - 26

1. 新增预览审批人的接口
2. 新增审批人为自己的时候自动审批通过

#### 4 - 28

1. 自测自动通过的流程是否正确。自己申请和流程中通过
2. 新增评分展示、撤销权限
3. 修改规范申请参数

#### 4 - 29

1. 自测门店 GMV 导入错误的问题，测试环境直接请求接口错误（应该是环境不对）

#### 4 - 30 [请假]

1. 前端要联调，但是我关机了。请假应该保持远程开启，放假都算了

#### /

#### 5 - 6

1. 排查优化入职第一课的整个同步流程中所有报错的地方，都加上处理
2. 调用微服务错误抛错，任务失败

#### 5 - 7

1. 更新到 test_cloud 环境提测
2. 发现部分没提交的功能：校验学习进度
3. 同步新功能的代办通知，了解通知后的处理逻辑，修改人员的获取
4. 修复门店获取教练错误的问题
5. 修复获取学习项目没有保存 URL 的问题，应该让刘科修改，至少也应该让他知道~

#### 5 - 8 

1. 重新整理第一课的相关逻辑和优化
2. 更新到 test_cloud 环境自测相关修改是否正确
3. 修复门店的计件方式不正确

#### 5 - 9

1. 修复 HR 的数据错误
2. 修复评分模式：加盟商 + 教练 = 评分
3. 修复审核的评分模式

#### 5 - 10

1. 排查一下三个用户不在这个门店，但是其 umu 系统在（应该是是人为操作）
2. 新增一个注解日志记录，参考：框架自带的注解 @BussinessLog 实现方式
3. 自测一下可以生成日志信息

#### 5 - 11

1. 自测通过不同途径请求的日志信息是否准确
2. 新增记录异常信息
3. 自测微服务调用的异常信息和业务异常等

#### /

#### 5 - 13

1. 不喜欢用 apifox 的 token 问题解决：

   1. 每个项目都新增TOKEN接口
   2. access_token 设置到环境变量中
   3. 自己建一个环境（区分人员）全局变量引用环境变量
   4. 不同账号不同用例

2. 不喜欢用 apifox 的接口问题：项目的接口管理混乱，可能接口未更新到

   大部分接口还是有的，**没有的话，需要也可以主动更新上去**

3. 有问题就要去解决、去了解，尽量别搞自己的标准

4. 改一下 AOP 日志可能抛错的问题

#### 5 - 14

1. 和产品沟通，这个日志测试看一下就行
2. 和刘科确定哪些需要再加这些日志，主要是 feign 的请求
3. 整理所有可能用到的 client 的地方，影响的接口 [产出文档](https://cx5n8kbm14.feishu.cn/wiki/MkEiw5si7inn4wkNySacqCmwnYd)
4. 更新到 test_cloud 环境，点几个接口正常记录

#### 5 - 15

1. 看下记录的日志数据是否正常
2. 排查某个用户晋升通过 & 课程完成 100%，但是没有晋升的问题
   1. 从同步数据上看没有返回这个用户的进度：因为他2月学习完所有课程，只同步近2个月的
   2. 在 umu 上查询这个人所有进度：不是最后学习时间，**自己是技术居然业务提醒同步的字段 ！该打~**
   3. 后确定方案为：手动添加数据（现阶段确实没办法，其实2个月的数据也够多了）

#### 5 - 16

1. 还是看下日志数据记录
2. 看下项目的 gitlab 、 deploy 的配置文件

#### 5 - 17

1. 要整理一下学堂这边的同步数据学员和分组的逻辑

#### /

#### 5 - 20

1. 
2. 检查功夫、学堂、UMU 的部门数据如何进行同步

#### 5 - 21

1. 讨论了一下同步方案，以功夫为准组装门店路径，后对比学堂、UMU 数据是否匹配
2. 先做飞书人员职级的同步功能

#### 5 - 22

1. 查看飞书的相关接口文档

#### 5 - 23

#### 5 - 24

1. 完成

#### /

#### 5 - 27

1. 确认飞书 SDK 的版本问题，使用黄忠祥说的接口请求
2. 在飞书正式企业的页面上请求调用接口，模拟数据
3. 进入测试企业后，创建自建应用
4. 进入自建应用调试职务、员工、异动列表等接口数据
5. 协助排查学堂中【李春波】用户学习完成未点亮：排查为 umu 的数据错误**（如果是三方的问题，要负责去和三方对接确认好，业务方就是我们的用户 ！）**
6. 使用 MQ 的方式来测试调用一下

#### 5 - 28

1. 为什么 mq 调不通：因为配置就错拉，一直都考虑是规范的问题（其实现有系统中有例子）
2. 自测 mq 的数据调用功能
3. 新增所有修改 post 的功能消息 mq 发送
4. 测试页面修改职务，发送的消息正常；修改没有员工数据的情况处理

#### 5 - 29

1. 和申巧确认一下数据是不是需要处理
2. 

#### 5 - 30

1. 看一下现有环境 jenkins 的脚本编写，基本操作都是通过本地的脚本来执行的

   ```groovy
   // import_common.sh 才是具体的命令语句
   steps {
       sh '''#!/bin/bash
       export run_type="maven"
       bash -x /script_data/import_common.sh
       '''
   }
   ```

2. 整理海外的数据，**整理错了所有不相同的门店**（其实只要红色的门店）主线都没搞清楚，就跑啊

#### 5 - 31

1. 整理一下数据，然后通过接口去测试一下。直接改 @TableName 可以操作 _temp 表
2. 升级一下 IDEA-Community 2024

#### /

#### 6 - 3

1. 排查员工补贴数据的问题：因之前离职未清理计件数据，重新入职后采用了原来的补贴金额

2. 消息订阅导致启动失败：提交的代码被合并拉（提交了就当作提测 ？**配置好测试环境 ！**）

3. 查看下当前项目的 gitlab-ci.yml 的各个阶段脚本；info、clean、install、build、deploy

   info、clean、install 略

   **build 关键步骤：**

   1. 通过 rule 指定只有只有当 module-ci.yml 文件变更时才打包（避免提交就打包）
   2. 移动到模块的目录，执行 maven package 命令
   3. 通过 cache 缓存打包后的 target 目录
   4. 暂停、删除模块对应的 docker image （变量命名）
   5. 使用 docker build 构建指定目录 ./Dockerfile 镜像，**问题：**
      1. maven和docker都在一台机器，相当于绑定了 ？
      2. 没有推到镜像仓库，那不能多机部署拉 ？
      3. 这里可以直接引用到 targe 目录，证明cache 不是给构建用的，而是在其他项目中引用 ？

   **deploy 关键步骤：**

   1. 也通过 rule 指定 ci 文件变更才执行
   2. 用 needs 指定前一个 build-job 运行后才执行
   3. 关闭所有 docker container 并重新运行新的

#### 6 - 4

1. 自己写下脚本
2. 删除 umu 用户时检查用户是否为游客，是则更新其补贴为0
3. 查看代码：员工离职、删除、新增、修改为游客。会调用删除 umu 用户的方法，不管~
4. 重置的代码写在哪里：
   1. ~~feign 接口中：要加游客参数，可能影响调用~~
   2. ~~user 中：每个调用都要新增，后续都要加~~
   3. 直接改所有的数据：可能多产生一次请求（**从实际业务需求来考虑，别局限于代码逻辑~**）

#### 6 - 5

1. 提测，没有删除技能 -> 改
2. 

#### 6 - 6

1. 更新到测试环境后，自测功能
2. 新的 UAT 发布方式，测试分支没问题 -> 创建发布分支 -> 功能分支合并到发布分支 -> 发布分支更新到UAT -> 校验 UAT 环境
3. 现在 UAT-umu 的数据库不是  test_cloud 的数据库（从日志就可以看到新的数据库了~~ 再问一遍感觉有傻）
4. 准备发包，看一下怎么解决这个 4K 的问题~ 迷你主机 ！

#### 6 - 7

1. 上午请假
2. 带教的页面关系图
   1. 补贴的保留 -> 徒弟的晋升记录
   2. **课程的进度是对应的 umu 的进度 ？** 课程进度：技能的标签
   3. 历史师徒关系需要保留
   4. 师徒关系中的**已撤回**的逻辑（应该是说申请师徒关系，然后撤回。但是要记录在师徒关系中么）
   5. 新的审批类型：师徒（新的审批流程 OR 复用审批？）
   6. **师徒关系要和升级关系绑定 ？** 

#### /

#### 6 - 11

1. 下午评审师徒关系的需求
2. 技术演进的分享，项目的演进方式
3. 整理相关功能点和需要的表字段

#### 6 - 12

1. 创建师徒关系表 和 师徒关系申请表
2. 分配功能点后，生成基础类

#### 6 - 13

1. 本店师父列表：查询本门店对应级别的人员信息
2. 其他店师父列表：用 /blade-user/list/listByPhoneOrCode?fuzzy=15181010990

#### 6 - 14

1. 检查师父是否满员接口
2. 申请审批接口

/ 

#### 6 - 17

1. 申请详情接口
2. 人员审批接口

#### 6 - 18

1. 解绑申请接口
2. 撤销申请接口

#### 6 - 19

1. 解除绑定被拒绝，不修改师徒关系
2. 修改师徒关系状态，必须当前是：待确认、绑定中；其他状态值设置后不能被修改
3. 拉通测试接口正确性**（还要写单元测试 ）**

#### 6 - 20

1. 协助在测试环境中创建的账号测试同步的方法
   1. 人员要在飞书 people 中
   2. 测试企业中没有对应的异动
2. 认为会出事的一定会出事！**（有点模糊的，就问清楚为止）**
3. 一个服务一个消费组，才符合 consumer-group 的定义（相同的订阅）
4. 修改异动的匹配方式为：配置的方式
5. **TODO : 删除飞书中的获取 token 的相关方法，都采用飞书 SDK**
6. feign 序列化时间方式错误，采用 dto 去除时间

#### 6 - 21

1. 测试实体审批的流程
2. 完成晋升的修改关系
3. 完成离职的修改关系，已修改了
4. ~~TODO 完成徒弟页面的相关接口~~

#### /

#### 6 - 24

1. 默认的茶饮师的晋升时间：功能上线时间（一定要修改！！！）
2. 师父 - 指定月份晋升数量和补贴总额
3. 师父 - 指定月份晋升的徒弟信息
4. 师父 - 当前徒弟列表和课程进度
5. 师父 - 所有徒弟分页查询
6. 徒弟 - 下一职级和学习进度
7. 徒弟 - 当前绑定的师父信息
8. 徒弟 - 所有师父列表

#### 6 - 25

1. 使用 test_cloud 使用本地 nacos 进行测试，结果启动微服务内存直接崩拉~
2. ~~TODO~~ 当前审批列表未展示师徒申请，结果：有数据展示出来，没有适配而已
3. 门店名称未展示：根据类型处理一下
4. 查一下 bladex 的测试用例怎么写 

#### 6 - 26

1. 本地服务和前端联调（然后要更新到测试服去）
2. **在 test_cloud 中 每个项目 剔除掉已弃用功能的相关代码**
3. 合并师徒关系的代码，并发包（私服的包有问题 要 deploy）

#### 6 - 27

1. 按照 bladex 官方的教程写测试用例，也无法启动**（为什么获取不到 nacos 的配置 ！！！）**
2. 员工的门店取错：都有地方修改过了，就应该统一
3. 修复用户头像、绑定的状态值、未审核检测

#### 6 - 28

1. controller 的测试用例
2. 传递了 token 但是还是没有数据，单测引用不到相关的微服务。问题还是 nacos 注册的问题
3. 一步步 debug 源码找 nacos host 的加载点...
4. 源码不如直接在 Launcher 中看加载配置，发现问题：**没有覆盖配置项 ！！！**

#### /

#### 07 - 01

1. 使用自动的获取 token 的代码来运行单测 ？
2. 修复申请解除绑定后师徒关系直接被更新
3. 修复撤销申请后师徒关系被删除的问题
4. 所有 controller 的单元测试方法编写

#### 07 - 02

1. 用户页面和个人信息，新增师父电话信息
2. **TODO** 系统和小程序的权限变更，谁来配置 ？
3. - [x] **TODO 对接工资的带训补贴**

#### 07 - 03

1. **TODO** 带训标签是否是一个技能：是
2. **TODO** 之前的师徒关系的要同步到新的师徒关系
3. 测试环境执行定时任务未更新关系
   1. 本地写测试用例可以更新成功
   2. 新增更新日志，排查环境问题
   3. 测试技能课程不正确，定时任务失败。同步课程
   4. 一个用户的多个晋升记录的情况处理（数据堆积）
4. 直接添加技能（茶生第一课）没有修改计件方式

#### 07 - 04

1. 早上确定：添加技能后修改为计件
2. 添加功能并自测一下：对一下需求发现太多上不了
3. 晋升后有入职时间没有补贴金额 - 因为入职时间超过，初步排查时 2023 看成 2024 了

#### 07 - 05

1. 编辑或导入技能时，修改员工的计件方式

#### / 

#### 07 - 08

1. **TODO** 把审批人改成两个
2. 排查审批错误的问题：门店的开店时间格式化错误
3. 覆盖导入时需要判定是否有第一课，删除需要改成：不计件
4. 测试一下接口添加、删除技能；导入覆盖、非覆盖技能 都正常

#### 07 - 09

1. 对接工资模块的带训补贴
2. 修复 BUG
   1. 徒弟离职状态错误
   2. 师父关系倒序
   3. 最多五个徒弟
   4. 师父门店名称
3. 带训补贴同步失败的处理（**新增定时重新同步任务**）

#### 07 - 10

1. 测试带训补贴的同步结果
2. 提测配置第一课的技能联动计件方式，问题：
   1. 配置技能会修改岗位，若修改为店长则不应该计件
   2. 同理从店长修改为普通岗位有第一课应该修改为计件
3. 修改更新计件的方式，根据用户当前岗位和技能直接判定其计件标记
4. 撤销和恢复技能也需要更新计件方式
5. 更新到测试环境并自测

#### 07 - 11

1. **页面改技能后改需求：要考虑其深层次需求关系，技能变更的地方太多了 ！**
2. 排查其他修改技能的地方（修改补贴的调用确认），要不要修改计件方式：除了补休和晋升都有
3. 排查 BUG 
   1. 创建时间没有数据 - 手动设置
   2. 查询技能状态报错 - 排除空列表
   3. 撤销/恢复技能 - 计算补贴错误
   4. 撤销/恢复技能 - 恢复显示技能错误
   5. 撤销/恢复技能 - 恢复技能查询错误
4. 新增当前审批人（类似预估审批人）添加所有类型审批的审批人数据
5. 考虑预估审批人可能出现的更新问题 - 更新太麻烦，不更新

#### /

#### 07 - 15

1. **我的审批 - 展示需我审批的数据逻辑：要现确定一个审批人，但是大部分审批其实都是不确定是谁。除了师徒关系能确定是师父**
2. 和产品沟通这个数据逻辑：只显示师徒关系申请的当前审批人
3. 改造 2 个审批人的各个接口
4. 发送到代办列表，删除旧索引，新增 deal_user_id 到索引中
5. 代办的更新和结束业务逻辑

#### 07 - 16

1. 审批人应该是【门店负责人】而不是管理者
2. 还是需要【等待审批】的状态值（因为默认的 status = 1）
3. 待办
   1. 消息标题处理
   2. 一个审批同意后待办状态更新
   3. 一个审批多个待办，新增时将其他待办更新为已完成
4. 师父审批后更新当前审批人为：门店负责人
5. 申请其他店的师父不能看到审批的情况

#### 07 - 17

1. 上到 UAT 环境上，执行 SQL ，还要发 USER 的哦
2. 门店负责人（通过门店查询）看不到其他店的申请
3. 申请重复了，加了请求限制
4. UAT 执行同步数据失败：因为技能课程不对

#### 07 - 18

1. 门店中的审批功能有两个重复的申请的问题（之前的只有一个审批人）
2. **配置定时任务**
3. 优化同步失败的数据
4. 编写旧的师徒关系同步 SQL 和数据组装
5. 等发包后测试数据，部分 SQL 没有执行其他正常

#### 07 - 19

1. 早上请假
2. 旧的师徒关系没有同步到 UMU，逻辑就是这样
3. 查看二期的需求文档

#### /

#### 7 - 22

1. 首页提醒接口
2. 二期的其他需求整理

#### 7 - 23

1. 新增茶饮师岗位技能熟练度
2. 职位变动后，检查职级及以下的所有技能，没有的检查下学习进度并点亮

#### 7 - 24

1. 自动发起晋升申请的功能
2. TODO  什么时候会同步点亮技能并触发自动晋升呢~
3. 排班的岗位技能校验
4. 自动开启 umu 账号功能
   1. 注册成功
   2. 重新激活 
5. UMU创建账号的服务调用

#### 7 - 25

1. 给排班提供查询技能接口
2. 职位变更后对齐技能
3. 排查用户什么时候需要（新增、启用）开通学堂账号

#### 7 - 26

1. 

#### /

#### 7 - 29

1. 新增每天定时任务同步所有岗位和对应课程的学习进度，然后点亮技能
2. 下午排查发包失败的原因：多个库的优先级不一样
3. 自测定时任务同步岗位是否正确

#### 7 - 30

1. 一期补充需求：带训通过率、师徒关系更新时间、教练不检查带训技能
2. 和前端对接需求
3. 排查线上任务未正确执行的问题
4. 修改手动晋升申请检查是否获得所有技能
5. 晋升成功后更新职位、补贴职位、师徒关系、移出UMU分组

#### 7 - 31

1. 确认晋升分组只通过职位进行匹配，晋升后将其移出对应职位的分组就行
2. 自测后准备发包（其他功能在一个分支不能发... 合并了半天）
3. 一期补充需求提测到 UAT
4. 定时任务新增到晋升分组并同步到 UMU

#### 8 - 1

1. 师徒关系的师父关系提示：定位 - 其他分支加的，让他们也上线
2. 排查晋升后师徒关系没有解除的问题 - 因为没有晋升申请所以不会同步
3. 新增用户到晋升分组的实现和代码自测
4. 提取之前的修改计件的代码和计件条件新增岗位技能才行
5. 用户列表新增计件标记的数据
6. 提取熟练度对接工时

#### 8 - 2

1. 合并代码发测试
2. 整理所有修改的功能点
3. 和前端确认不需要：员工计件状态
4. 同步 UMU 人员新增角色判定
5. 新增查询值班技能

#### /

#### 8 - 5

1. 
2. 自测技能学习进度同步后提交晋升申请，申请审批后的数据处理

#### 8 - 6 请假

#### 8 - 7

1. 排查测试的未生成申请的问题：可能是定时任务执行太快，umu数据还未落地
2. 整理营运人员的相关数据和对比
3. 完成修改营运人员、专员、开店教练等可以为空的功能
4. 写测试用例自测功能
5. 解答：离职后师徒关系中的门店信息不更新

#### 8 - 8 

1. 发布 store 测试环境，冲突合并和解决
2. 修复管家同步错误：营运人员为同一人时更新不正确的问题
3. 本地测试创建人员未开通 UMU 账号的问题

#### 8 - 9

1. 修复创建人员没法开通UMU账号的问题：因事务数据未提交
2. 学堂二期补充需求开会
3. 整理补充需求点和功能分析

#### /

#### 8 - 12

1. 需求任务更新到 WBS
2. 使用小节进行同步的方案编写
3. 修复营运人员为空的错误（**不清楚的一定要搞清楚，不清楚的一定会出问题！！！**）
4. 使用【小节学习明细列表】接口同步小节的学习进度

#### 8  - 13

1. 技能配置小节ID 的接口是否改造，用原来的字段改个名字？
2. 前端需要改造的接口
3. apifox 同步到新的团队接口
4. 编写直接指定师徒关系的接口

#### 8 - 14

1. 用新的 apifox 团队自测直接指定师徒关系（直接单元测试 ？）
2. 晋升审批修改为多个人审批
3. 晋升多人审批的待办处理
4. 把  master 合并到开发分支

#### 8 - 15

1. 修复导入 GMV 的月份错误判断 和 月份过期判断
2. 需要上线的发测试和 UAT 环境
3. 多个人审批的晋升申请
4. UAT 小程序报错：小程序没有区分测试 / UAT，但后端项目没有发 UAT
5. 多人审批的详情、撤销等接口

#### 8 - 16

1. 

#### /

#### 8 - 19

1. 本地启动项目：直接连云上的 nacos 不行，复制下来启动调试，结合其他的命名空间的配置设置
2. 测试晋升的多人审批功能，功能是否正常

#### 8 - 20

1. 看看给飞书发消息可不可以成功，启动 tripartite：取消 topic ，注销所有 xxljob
2. 店助的特殊晋升审批方式，普通店助不修改职级
3. 在普通店助有晋升申请后，点亮了所有技能就直接晋升

#### 8 - 21

1. 技能可以配置小节的信息
2. 用单元测试小节配置功能是否正常
3. 通过小节ID 查询学习列表，每天同步技能
4. 每天同步技能时，若小节的 URL 为空则顺便更新
5. 单元测试每日同步技能是否正常
6. 门店营运人员的预览信息

#### 8 - 22

1. 修改补休的所有同步都使用小节的查询：有 URL 优先，没有就用 ID
2. 师徒补贴通过指定技能对应的小节完成时间进行判断
3. 单元测试以上功能

#### 8 - 23

1. 新增国际化的提示
2. 所有代码提交和发包
3. 上测试后，校验开发功能是否正常

#### /

#### 8 - 26

1. 查看门店 GMV 数据被修改的问题：确认运营修改，但是无法查询到历史数值，要日志记录么 ？
2. 编辑技能未配置小节的报错问题，更新到测试环境
3. 修复升级为普通店助时，调用补贴恢复功能未更新的问题：事务未提交，执行错误
4. 本地测试后，发布测试环境
5. 晋升的数据不正常的问题：在其他店提了申请，审批人离职（不能驳回）他调店了（不能取消）

#### 8 - 27

#### 8 - 28

#### 8 - 29

#### 8 - 30

#### /

#### 9 - 1,2

1. 等待发包更新
2. 创建分组
3. 处理线上已有的带训师徒：从默认分组 改为 从功夫数据库中导出再导入
4. 只有排班技能才显示合格（应该前端修改，但需要审批，故后端改）
5. 修复指定师父未同步至 UMU 的问题
6. 第一课和技能无法同步：
   1. 学习完成后 umu 那边数据延迟 4 小时，才同步到
   2. 点评小节同步的进度信息：为点评人的进度，不符合被点评人进度的要求（等待UMU解决）
7. 后续用通用的课程小节同步成功了 ！！！

#### 9 - 3

1. 排查上线后的功能是否正常
2. 排查测试情况

#### 9 - 4

1. 所有符合条件的门店用户、加盟商 直接开通学堂帐号
2. 删除所有公司账号的UMU账号关联、部门关联、分组关联
3. 编写用例自测
4. 排查店长为什么会有晋升申请：导入技能成为店长 -> 被修改为茶饮师 -> 发起晋升 -> 其他人重新把他改成店长 -> 同时发起晋升后自己驳回
5. （加班）排查入职第一课莫名没有的问题：实际上之前就撤销，但是标记未修改，导致工资读取到错数据

#### 9 - 5

1. 新增接口的参数，方便测试，发UAT
2. 给测试说怎么测这个功能
3. 排查离职用户未删除 UMU 的账号问题，因关联表数据直接被删除
4. 考虑第一课同步：先筛选出没有获取的第一课的人 * 课程数 = 18000 次 / 600次 1min = 30min ? 
   1. 现阶段：一个课程大概 2 个月 250 * 100 的数据，请求次数 = 9 * 250 = 2400次
   2. **2400次 * 100 vs  18000次**
5. 发版本：
   1. 删除报错 - 重新执行后正常
   2. 新开通账号，剩余 18 个无工号 无法开通

#### 9 - 6

1. 

#### /

#### 9 - 9 

1. 永久闭店不删除学堂账号
2. 变更为游客需要删除学堂账号
3. 自测功能是否正常
4. 整理所有可能影响的功能点

#### 9 - 10

1. 补休分组不拉取，游客和公司用户到指定分组
2. 以点亮所有技能、游客、公司用户从对应的补休分组中移出
3. UMU 点评小节的无法直接返回【被点评人信息】，需要新增额外的数据结构
4. 修改成通过 evalution_user_list 获取被点评人的状态值
5. 兼容点评小节 和 普通小节的不同数据获取方式
6. 新增在修改小节时更新拉取 URL 数据

#### 9 - 11

1. 修复对齐技能没有小节信息，导致报错的问题
2. 优化查询单个小节的信息时，没有小节URL则获取一次
3. 对齐技能 - 也需要点亮入职第一课的技能
4. 修复对齐技能点亮第一课，单个课程就点亮的 BUG

#### / 中秋

#### 9 - 18

1. 排查用户未正常点亮第一课：因为UMU被攻击，请求失败。大部分用户在 16 号点亮（定时任务执行失败应该有通知）
2. UMU分组用户关系表，新增唯一索引，创建时间，修改时间字段
3. 所有新增关系数据时，如果重复进行更新
4. 排查技能的修改时间 > 创建时间：create_time 在更新时自动更新了

#### 9 - 19

1. 排查14号学习完成但是工资归档中 9-15 为不计件的数据：基本都 16 号就点亮了，有一个独特的10290094用户
2. 修改指定 9-15 未计件的学习完成用户的工资归档数据
3. 删除重复的分组用户数据，用 SQL
4. 排查10290094未点亮技能的原因：模拟UMU接口请求，发现因UMU数据确实未返回
5. 这个用户单独修改 9-15 到 9 - 18 的工资归档数据
6. 修复门店直接绑定师徒关系没有绑定时间、没有更新时间、失败后也有师徒关系
7. 修改线上的没有绑定时间的数据

#### 9 - 20

#### /

#### 9 - 23

1. 修改晋升审批

#### 9 - 24

1. 

#### 9 - 25

1. 

#### 9 - 29

1. 业务发现线上**已经是店长**点亮了技能没有补贴金额
2. 问题 - 确定为手动修改为的店长，没有通过晋升流程（之前：所有职级都判断了晋升申请）
3. 修改 - 和产品确定：1. 店长直接获得店长补贴 2. 其他需要有晋升申请记录
4. 修复 - 线上数据：1.更新技能补贴的数据 2. 更新涉及人员 09-02 开始的工资归档（**方式：归档当日补贴 + 缺失技能补贴，导致超过2900！！！**）

#### 9 - 30 

1. 排查 - 线上的数据发现有些数据超过补贴总额
2. 排查 - 有些现在是店长，但是获得技能之后不是店长。后改为店长的，但是把的是店助的日期也修改了
3. 排查 - 之前更新涉及到 09-01 之前点亮的技能未恢复补贴（后确定也要改）
4. 修复 - 1. 当日是店助的归档工资恢复 2. 09-01之前点亮的无技能补贴恢复
5. **上线后问题 - 3. 点亮店长技能当天的技能总额 +  技能补贴，更新之后每天归档数据**
   1. 当天技能总额：会把之后日期的技能变动的都更新为当天的总额，**以为**刷一遍店长技能之后的都能更新到~
   2. 更新之后每天：**如果店长技能后获得其他技能，并不会再更新到 ！！！**
   3. 测试时店长技能是最后获取的，所以就没测试出来 ！！！

#### 10 - 01 

1. 直接以当天的技能重新算补贴总额，这样就是新的总额也不会超标。从根本上解决问题
2. **复盘：**
   1. 第一次：1. 店助的日期归档工资也改了（不细心） 2. 在总额上加上补贴后超额（加补贴，涉及到的场景太复杂）
   2. 第二次：1.以店长技能的获得时间，把后续的每天都更新（以为每个都能刷到，但是在店长技能后获得技能就不行） 2. 把09-01之前的店长技能也更新
   3. 第三次：先把技能补贴加上，其实就能确定影响到的人，然后重新计算每天的总额。根本上解决问题

#### / 国庆

#### 10 - 08

1. 排查【方泽泉】的技能未点亮的问题：因为换店导致之前的被删除了，然后新建了UMU账号，后把新建的删除了恢复旧帐号（umu_id 数据不对应）
2. 排查新的是店长但技能无补贴的数据：都是手动修改为店长的，获得技能时是店助所以没补贴
3. 修改职位和修改人员需要更新技能补贴的数据

#### 10 - 09

1. 所有修改职位的地方都加上更新技能
2. 讨论是否需要把点亮技能的条件（非店长）和更新技能的条件（只店助）修改为一致
3. 条件为非店长：需要将之前的非店长点亮店长技能的补贴金额都更新掉（1283行 324人），~~并且需要重算对应的工资~~（产品确定不重算工资，更新后就没有补贴就行）
4. 修改更新技能时，非店长 && 无申请 = 重置店长技能补贴，店长 || 有申请 = 恢复店长技能金额

#### 10 - 10

1. 给测试说需要验证的内容
2. 沟通是否需要排除店长技能总额：确定去除这个条件
3. 排查所有涉及技能改动的地方是否更改补贴条件一致
4. 提测后发 UAT
5. 更新 SQL：非店长 + 有店长技能 + 没有店助晋升申请 = 去掉店长技能补贴

#### 10 - 11

1. 整理 - 在 10-01 后手动改为店长的 + 没有店长技能补贴的人员数据，改店长时间 + 最后技能点亮时间
2. 新写 - 重跑工资的 SQL 和 加上技能补贴的 SQL
3. 排查 - 门店的营运人员 9-13 更新后未同步：管家2.0 初始化门店的营运人员**不会同步**到功夫，更新才会
4. 排查 - 两个门店合并，其中一个门店账号在 UMU 中被删除，但是在 chagee-umu 中有数据：从管家同步门店关闭，删除了人员；后续又恢复成未删除

#### 10 - 12 

1. 整理 - 每日记录和复盘修复日志
2. 测试 - 检查手动修改店长的人员变动和影响数据